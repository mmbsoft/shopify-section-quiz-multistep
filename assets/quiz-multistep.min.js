customElements.get("shopify-question")||customElements.define("shopify-question",class extends HTMLElement{connectedCallback(){const t=Number(this.dataset.step),e=this.dataset.question,s=this.dataset.nextLabel,i=JSON.parse(this.dataset.answers);this.innerHTML=`\n          <details class="quiz__step collapsible-content ${1===t?"":"locked"} scroll-trigger animate--fade-in" ${1===t?"open":""}>\n            <summary class="quiz__summary"><span class="quiz__step-number">${t}</span> <span class="quiz__summary-text">${e}</span></summary>\n            <div class="quiz__body collapsible-content__inner">\n              <div class="quiz__options">\n                ${i.map(t=>`\n                    <button type="button" class="quiz__option card card--standard" data-tag="${t.tag}">\n                      <div class="card__content">\n                        <span class="card__heading h5">${t.label}</span>\n                      </div>\n                    </button>\n                  `).join("")}\n              </div>\n              <p class="quiz__error hidden">Please select an answer to continue.</p>\n              <div class="quiz__actions">\n                <button type="button" class="button button--secondary quiz__next" data-step="${t}">${s}</button>\n              </div>\n            </div>\n          </details>\n        `,this.details=this.querySelector(".quiz__step"),this.summary=this.querySelector(".quiz__summary"),this.error=this.querySelector(".quiz__error"),this.nextBtn=this.querySelector(".quiz__next"),this.options=this.querySelectorAll(".quiz__option"),this.selected=null,this.summary.addEventListener("click",t=>{this.details.classList.contains("locked")?(t.preventDefault(),t.stopPropagation()):this.dispatchEvent(new CustomEvent("summary-toggled",{bubbles:!0}))}),this.options.forEach(t=>{t.addEventListener("click",()=>{this.options.forEach(t=>t.classList.remove("is-selected")),t.classList.add("is-selected"),this.selected=t.dataset.tag})}),this.nextBtn.addEventListener("click",()=>{if(!this.selected)return void this.error.classList.remove("hidden");this.error.classList.add("hidden");const e=this.closest("shopify-quiz"),s=e?e.querySelectorAll("shopify-question").length:t,i=t===s;this.dispatchEvent(new CustomEvent("step-complete",{bubbles:!0,detail:{step:t,tag:this.selected,final:i}}))})}}),customElements.get("shopify-quiz")||customElements.define("shopify-quiz",class extends HTMLElement{constructor(){super(),this.tags=[],this.currentStep=1}connectedCallback(){this.questions=Array.from(this.querySelectorAll("shopify-question")),this.resultsLabel=this.dataset.resultsLabel||"See results",this.progress=document.querySelector(".quiz__progress-fill");const t=document.querySelector(".quiz__progress-wrapper");if(t&&!t.querySelector(".quiz__progress-label")){const e=document.createElement("div");e.className="quiz__progress-label",t.insertBefore(e,t.firstChild)}this.setupInitialSteps(),this.ensureFinalButtonLabel(),this.updateProgress(),this.addEventListener("summary-toggled",t=>{const e=t.target.closest(".quiz__step");this.questions.forEach(t=>{const s=t.querySelector(".quiz__step");s!==e&&s.removeAttribute("open")})}),this.addEventListener("step-complete",t=>{const{step:e,tag:s,final:i}=t.detail;this.tags[e-1]=s,i?this.showResults(this.tags):this.activateStep(e+1)})}setupInitialSteps(){this.questions.forEach((t,e)=>{const s=t.querySelector(".quiz__step");0===e?(s.classList.remove("locked"),s.setAttribute("open","")):(s.classList.add("locked"),s.removeAttribute("open"))})}ensureFinalButtonLabel(){if(!this.questions.length)return;const t=this.questions[this.questions.length-1].querySelector(".quiz__next");t&&(t.textContent=this.resultsLabel,t.classList.remove("button--secondary"),t.classList.add("button"))}activateStep(t){this.currentStep=t,this.questions.forEach((e,s)=>{const i=e.querySelector(".quiz__step");s+1===t?(i.classList.remove("locked"),i.setAttribute("open",""),i.scrollIntoView({behavior:"smooth",block:"center"})):(i.removeAttribute("open"),s+1>t?i.classList.add("locked"):i.classList.remove("locked"))}),this.updateProgress(),t===this.questions.length&&this.ensureFinalButtonLabel()}updateProgress(){if(!this.progress)return;const t=this.currentStep/this.questions.length*100;this.progress.style.width=`${t}%`;const e=document.querySelector(".quiz__progress-label");e&&(e.textContent=`Step ${this.currentStep} / ${this.questions.length}`)}async showResults(t){const e=document.getElementById("quiz-results"),s=document.getElementById("quiz-results-content");e.classList.remove("hidden"),s.innerHTML='<div class="quiz-loader"></div>';const i="main-collection-product-grid",n=new URLSearchParams;n.append("sections",i),t.forEach(t=>n.append("filter.p.m.custom.tags",t));const o=`/collections/all?${n.toString()}`;try{const t=await fetch(o,{credentials:"same-origin"});if(!t.ok)throw new Error(`HTTP ${t.status}`);let e=(await t.json())[i];e&&e.trim().length>0?(e=e.replace(/<form[^>]*id="SortByForm"[\s\S]*?<\/form>/gi,"").replace(/<select[^>]*id="SortBy"[\s\S]*?<\/select>/gi,"").replace(/<facet-filters-form[\s\S]*?<\/facet-filters-form>/gi,"").replace(/<div[^>]*id="ProductCount"[\s\S]*?<\/div>/gi,"").replace(/<h1[^>]*class="collection-title"[\s\S]*?<\/h1>/gi,"").replace(/<div[^>]*class="collection-description"[\s\S]*?<\/div>/gi,""),s.innerHTML=e):s.innerHTML="<p>Brak produktów spełniających wybrane kryteria.</p>"}catch(t){s.innerHTML="<p>Wystąpił problem podczas wczytywania wyników. Spróbuj ponownie później.</p>",console.error(t)}}});
//# sourceMappingURL=quiz-multistep.min.js.map
