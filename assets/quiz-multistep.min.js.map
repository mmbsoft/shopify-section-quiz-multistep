{"version":3,"file":"quiz-multistep.min.js","names":["customElements","get","define","HTMLElement","connectedCallback","step","Number","this","dataset","question","nextLabel","data","JSON","parse","answers","innerHTML","map","option","tag","label","join","details","querySelector","summary","error","nextBtn","options","querySelectorAll","selected","addEventListener","e","classList","contains","preventDefault","stopPropagation","dispatchEvent","CustomEvent","bubbles","forEach","opt","o","remove","add","quizParent","closest","totalSteps","length","isFinal","detail","final","constructor","super","tags","currentStep","questions","Array","from","resultsLabel","progress","document","progressWrapper","createElement","className","insertBefore","firstChild","setupInitialSteps","ensureFinalButtonLabel","updateProgress","target","d","removeAttribute","showResults","activateStep","i","setAttribute","lastBtn","textContent","scrollIntoView","behavior","block","percent","style","width","resultsWrapper","getElementById","resultsContent","sectionHandle","params","URLSearchParams","append","url","toString","response","fetch","credentials","ok","Error","status","html","json","trim","replace","console"],"sources":["quiz-multistep.js"],"mappings":"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","ignoreList":[],"sourcesContent":["if (!customElements.get('shopify-question')) {\n  customElements.define(\n    'shopify-question',\n    class extends HTMLElement {\n      connectedCallback() {\n        const step = Number(this.dataset.step);\n        const question = this.dataset.question;\n        const nextLabel = this.dataset.nextLabel;\n        const data = JSON.parse(this.dataset.answers);\n        this.innerHTML = `\n          <details class=\"quiz__step collapsible-content ${\n            step === 1 ? '' : 'locked'\n          } scroll-trigger animate--fade-in\" ${step === 1 ? 'open' : ''}>\n            <summary class=\"quiz__summary\"><span class=\"quiz__step-number\">${step}</span> <span class=\"quiz__summary-text\">${question}</span></summary>\n            <div class=\"quiz__body collapsible-content__inner\">\n              <div class=\"quiz__options\">\n                ${data\n                  .map(\n                    (option) => `\n                    <button type=\"button\" class=\"quiz__option card card--standard\" data-tag=\"${option.tag}\">\n                      <div class=\"card__content\">\n                        <span class=\"card__heading h5\">${option.label}</span>\n                      </div>\n                    </button>\n                  `\n                  )\n                  .join('')}\n              </div>\n              <p class=\"quiz__error hidden\">Please select an answer to continue.</p>\n              <div class=\"quiz__actions\">\n                <button type=\"button\" class=\"button button--secondary quiz__next\" data-step=\"${step}\">${nextLabel}</button>\n              </div>\n            </div>\n          </details>\n        `;\n\n        this.details = this.querySelector('.quiz__step');\n        this.summary = this.querySelector('.quiz__summary');\n        this.error = this.querySelector('.quiz__error');\n        this.nextBtn = this.querySelector('.quiz__next');\n        this.options = this.querySelectorAll('.quiz__option');\n        this.selected = null;\n\n        this.summary.addEventListener('click', (e) => {\n          if (this.details.classList.contains('locked')) {\n            e.preventDefault();\n            e.stopPropagation();\n          } else {\n            this.dispatchEvent(new CustomEvent('summary-toggled', { bubbles: true }));\n          }\n        });\n\n        this.options.forEach((opt) => {\n          opt.addEventListener('click', () => {\n            this.options.forEach((o) => o.classList.remove('is-selected'));\n\n            opt.classList.add('is-selected');\n            this.selected = opt.dataset.tag;\n          });\n        });\n\n        this.nextBtn.addEventListener('click', () => {\n          if (!this.selected) {\n            this.error.classList.remove('hidden');\n            return;\n          }\n\n          this.error.classList.add('hidden');\n\n          const quizParent = this.closest('shopify-quiz');\n          const totalSteps = quizParent ? quizParent.querySelectorAll('shopify-question').length : step;\n          const isFinal = step === totalSteps;\n\n          this.dispatchEvent(\n            new CustomEvent('step-complete', {\n              bubbles: true,\n              detail: { step, tag: this.selected, final: isFinal },\n            })\n          );\n        });\n      }\n    }\n  );\n}\n\nif (!customElements.get('shopify-quiz')) {\n  customElements.define(\n    'shopify-quiz',\n    class extends HTMLElement {\n      constructor() {\n        super();\n\n        this.tags = [];\n        this.currentStep = 1;\n      }\n      connectedCallback() {\n        this.questions = Array.from(this.querySelectorAll('shopify-question'));\n        this.resultsLabel = this.dataset.resultsLabel || 'See results';\n        this.progress = document.querySelector('.quiz__progress-fill');\n\n        const progressWrapper = document.querySelector('.quiz__progress-wrapper');\n\n        if (progressWrapper && !progressWrapper.querySelector('.quiz__progress-label')) {\n          const label = document.createElement('div');\n\n          label.className = 'quiz__progress-label';\n          progressWrapper.insertBefore(label, progressWrapper.firstChild);\n        }\n\n        this.setupInitialSteps();\n        this.ensureFinalButtonLabel();\n        this.updateProgress();\n\n        this.addEventListener('summary-toggled', (e) => {\n          const details = e.target.closest('.quiz__step');\n\n          this.questions.forEach((question) => {\n            const d = question.querySelector('.quiz__step');\n            if (d !== details) d.removeAttribute('open');\n          });\n        });\n\n        this.addEventListener('step-complete', (e) => {\n          const { step, tag, final } = e.detail;\n\n          this.tags[step - 1] = tag;\n\n          if (final) {\n            this.showResults(this.tags);\n          } else {\n            this.activateStep(step + 1);\n          }\n        });\n      }\n\n      setupInitialSteps() {\n        this.questions.forEach((question, i) => {\n          const details = question.querySelector('.quiz__step');\n\n          if (i === 0) {\n            details.classList.remove('locked');\n            details.setAttribute('open', '');\n          } else {\n            details.classList.add('locked');\n            details.removeAttribute('open');\n          }\n        });\n      }\n\n      ensureFinalButtonLabel() {\n        if (!this.questions.length) return;\n\n        const lastQ = this.questions[this.questions.length - 1];\n        const lastBtn = lastQ.querySelector('.quiz__next');\n\n        if (lastBtn) {\n          lastBtn.textContent = this.resultsLabel;\n          lastBtn.classList.remove('button--secondary');\n          lastBtn.classList.add('button');\n        }\n      }\n\n      activateStep(step) {\n        this.currentStep = step;\n\n        this.questions.forEach((question, i) => {\n          const details = question.querySelector('.quiz__step');\n\n          if (i + 1 === step) {\n            details.classList.remove('locked');\n            details.setAttribute('open', '');\n\n            details.scrollIntoView({ behavior: 'smooth', block: 'center' });\n          } else {\n            details.removeAttribute('open');\n\n            if (i + 1 > step) details.classList.add('locked');\n            else details.classList.remove('locked');\n          }\n        });\n\n        this.updateProgress();\n\n        if (step === this.questions.length) {\n          this.ensureFinalButtonLabel();\n        }\n      }\n\n      updateProgress() {\n        if (!this.progress) return;\n\n        const percent = (this.currentStep / this.questions.length) * 100;\n        this.progress.style.width = `${percent}%`;\n\n        const label = document.querySelector('.quiz__progress-label');\n        if (label) label.textContent = `Step ${this.currentStep} / ${this.questions.length}`;\n      }\n\n      async showResults(tags) {\n        const resultsWrapper = document.getElementById('quiz-results');\n        const resultsContent = document.getElementById('quiz-results-content');\n\n        resultsWrapper.classList.remove('hidden');\n        resultsContent.innerHTML = `<div class=\"quiz-loader\"></div>`;\n\n        const sectionHandle = 'main-collection-product-grid';\n\n        const params = new URLSearchParams();\n        params.append('sections', sectionHandle);\n        tags.forEach((tag) => params.append('filter.p.m.custom.tags', tag));\n\n        const url = `/collections/all?${params.toString()}`;\n\n        try {\n          const response = await fetch(url, { credentials: 'same-origin' });\n          if (!response.ok) throw new Error(`HTTP ${response.status}`);\n\n          const data = await response.json();\n          let html = data[sectionHandle];\n\n          if (html && html.trim().length > 0) {\n            html = html\n              .replace(/<form[^>]*id=\"SortByForm\"[\\s\\S]*?<\\/form>/gi, '')\n              .replace(/<select[^>]*id=\"SortBy\"[\\s\\S]*?<\\/select>/gi, '')\n              .replace(/<facet-filters-form[\\s\\S]*?<\\/facet-filters-form>/gi, '')\n              .replace(/<div[^>]*id=\"ProductCount\"[\\s\\S]*?<\\/div>/gi, '')\n              .replace(/<h1[^>]*class=\"collection-title\"[\\s\\S]*?<\\/h1>/gi, '')\n              .replace(/<div[^>]*class=\"collection-description\"[\\s\\S]*?<\\/div>/gi, '');\n\n            resultsContent.innerHTML = html;\n          } else {\n            resultsContent.innerHTML = `<p>Brak produktów spełniających wybrane kryteria.</p>`;\n          }\n        } catch (error) {\n          resultsContent.innerHTML = `<p>Wystąpił problem podczas wczytywania wyników. Spróbuj ponownie później.</p>`;\n          console.error(error);\n        }\n      }\n    }\n  );\n}\n"]}